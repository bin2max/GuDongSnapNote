<view class="container">
  <view class="header">
    <text class="title">历史记录</text>
    <view class="header-actions">
      <button class="filter-btn" bindtap="toggleDateFilter">
        <text class="btn-text">筛选</text>
      </button>
      <button class="export-btn" bindtap="exportRecords" disabled="{{exporting}}">
        <text class="btn-text">{{exporting ? '导出中...' : '导出'}}</text>
      </button>
    </view>
  </view>

  <!-- 日期筛选区域 -->
  <view wx:if="{{showDateFilter}}" class="date-filter">
    <view class="filter-row">
      <view class="date-input-group">
        <text class="date-label">开始日期：</text>
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="date-picker">
            <text>{{startDate || '请选择'}}</text>
          </view>
        </picker>
      </view>
      <view class="date-input-group">
        <text class="date-label">结束日期：</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="date-picker">
            <text>{{endDate || '请选择'}}</text>
          </view>
        </picker>
      </view>
    </view>
    <view class="filter-actions">
      <button class="apply-btn" bindtap="applyDateFilter">应用筛选</button>
      <button class="clear-btn" bindtap="clearDateFilter">清除筛选</button>
    </view>
  </view>

  <view class="table-wrapper">
    <view class="table-header">
      <text class="th">序号</text>
      <text class="th">日期</text>
      <text class="th">车型</text>
      <text class="th">车牌号</text>
      <text class="th">驾驶人</text>
      <text class="th">电话</text>
      <text class="th">物资清单</text>
      <text class="th">进门时间</text>
      <text class="th">出门日期</text>
      <text class="th">出门时间</text>
      <text class="th">状态</text>
      <text class="th">值班人</text>
      <text class="th">备注</text>
    </view>
    <block wx:for="{{records}}" wx:key="_id">
      <view class="table-row" bindtap="onDetail" data-id="{{item._id}}">
        <text class="td">{{item.serial_number || '-'}}</text>
        <text class="td">{{item.date || '-'}}</text>
        <text class="td">{{item.vehicle_type || '-'}}</text>
        <text class="td">{{item.plate_number || '-'}}</text>
        <text class="td">{{item.driver_name || '-'}}</text>
        <text class="td">{{item.phone_number || '-'}}</text>
        <text class="td">{{item.formatted_cargo}}</text>
        <text class="td">{{item.formatted_in_time}}</text>
        <text class="td">{{item.out_date || '-'}}</text>
        <text class="td">{{item.formatted_out_time}}</text>
        <text class="td status-td {{item.status}}">{{item.formatted_status}}</text>
        <text class="td">{{item.duty_person || '-'}}</text>
        <text class="td remark-td">{{item.remark || '-'}}</text>
      </view>
    </block>
  </view>

  <view wx:if="{{records.length === 0}}" class="empty-state">
    <text class="empty-text">暂无历史记录</text>
  </view>
</view> 